<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Wetlab Helper Functions • Luciernaga</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Wetlab Helper Functions">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">Luciernaga</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.99.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/DataVisualization.html">Data Visualization</a></li>
    <li><a class="dropdown-item" href="../articles/DimensionalityVisualization.html">Dimensionality Visualization</a></li>
    <li><a class="dropdown-item" href="../articles/QualityControl.html">Quality Control</a></li>
    <li><a class="dropdown-item" href="../articles/FluorescenceSignatures.html">Fluorescence Signatures</a></li>
    <li><a class="dropdown-item" href="../articles/FluorescentReports.html">Fluorescent Reports</a></li>
    <li><a class="dropdown-item" href="../articles/Unmixing.html">Unmixing with Luciernaga</a></li>
    <li><a class="dropdown-item" href="../articles/Wetlab.html">Wetlab Helper Functions</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/DavidRach/Luciernaga/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Wetlab Helper Functions</h1>
                        <h4 data-toc-skip class="author">David Rach</h4>
            <address class="author_afil">
      University of Maryland,
Baltimore<br><a class="author_email" href="mailto:#"></a><a href="mailto:drach@som.umaryland.edu" class="email">drach@som.umaryland.edu</a>
      </address>
                  
            <h4 data-toc-skip class="date">1 June 2025</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/DavidRach/Luciernaga/blob/HEAD/vignettes/Wetlab.rmd" class="external-link"><code>vignettes/Wetlab.rmd</code></a></small>
      <div class="d-none name"><code>Wetlab.rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The following functions are geared mainly toward pre-acquisition
application within a wetlab context. Since I am going to the effort to
write an R package and document it with a vignette, I am including them
within Luciernaga.</p>
<p>Our typical workflow involves thawing human cord and peripheral blood
mononuclear cells (CBMC and PBMC respectively), spinning down to remove
the supernatant, and then resuspending. From these, we take 5 uL, stain
with anti-CD45, anti-CD14, and anti-CD19 to evaluate cell concentration
for the sample. These then go into 6 hours of rest at 3x10^6 cells per
ml, before being aliquoted to individual stimulation conditions
overnight.</p>
<p>The following three functions and associated workflow detailed below
are examples of what I do to speed the process along. I hope it provides
you with your own ideas that you can modify them to fit within your own
workflows and reduce the time spent at the bench trying to remember a
long-forgotten course.</p>
</div>
<div class="section level2">
<h2 id="getting-started">Getting Started<a class="anchor" aria-label="anchor" href="#getting-started"></a>
</h2>
<p>5 uL of sample are stained with the antibody mix (1uL CD45, 1uL CD14,
1.5uL CD19, 20 uL DPBS) for 6 minutes, before 480 uL of PBS is added
(roughly 1:100 dilution). Each sample is then counted on a Cytek Aurora
set to acquire 30 uL of each tube on high before stopping. We then
export these .fcs files and bring them into a FlowJo (TM) work space
that is set up to sort the .fcs files to groups set up for the three
instruments with different laser configurations present at our core. We
copy-paste the template, check the gates, and save the .wsp.</p>
<p>We then bring in the .wsp file to R using CytoML. It is possible to
skip the FlowJo portion of the workflow entirely using the openCyto
package in combination with <code><a href="../reference/Utility_GatingPlots.html">Utility_GatingPlots()</a></code> to
validate the gate placement for each specimen, but we will not document
this here for the time being.</p>
<p>We have saved a .wsp file “CellCounts” and two count .fcs files in
the Luciernaga extdata for this example.</p>
<p>First lets load the required libraries.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">flowCore</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">flowWorkspace</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RGLab/CytoML" class="external-link">CytoML</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/" class="external-link">purrr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org" class="external-link">lubridate</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://davidrach.github.io/Luciernaga/">Luciernaga</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.posit.co/" class="external-link">shiny</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/DillonHammill/DataEditR" class="external-link">DataEditR</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://gt.rstudio.com" class="external-link">gt</a></span><span class="op">)</span></span>
<span><span class="co">#library(ghibli)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://stringr.tidyverse.org" class="external-link">stringr</a></span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">File_Location</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, package <span class="op">=</span> <span class="st">"Luciernaga"</span><span class="op">)</span></span>
<span><span class="va">WSP_File</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">File_Location</span>, pattern<span class="op">=</span><span class="st">".wsp"</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">ws</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/CytoML/man/open_flowjo_xml.html" class="external-link">open_flowjo_xml</a></span><span class="op">(</span><span class="va">WSP_File</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">gs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/CytoML/man/flowjo_to_gatingset.html" class="external-link">flowjo_to_gatingset</a></span><span class="op">(</span><span class="va">ws</span>, name<span class="op">=</span><span class="fl">1</span>, path <span class="op">=</span> <span class="va">File_Location</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">gs</span><span class="op">)</span></span>
<span><span class="va">gs</span></span></code></pre></div>
<div class="section level3">
<h3 id="wetlab_concentration">Wetlab_Concentration<a class="anchor" aria-label="anchor" href="#wetlab_concentration"></a>
</h3>
<p>Now that the .wsp file is loaded into a GatingSet, we can use the
<code><a href="../reference/Wetlab_Concentration.html">Wetlab_Concentration()</a></code> function to derrive the cell
concentration for each sample. Luciernaga does this through use of the
count of events present at the designated subset level, in combination
with the description keywords recorded by the acquisition software. In
this case, both samples were present in a TotalVolume of 1. The code to
write the data to a .csv is included after the # symbols.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nameKeyword</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"GROUPNAME"</span>, <span class="st">"TUBENAME"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">TheData</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span>.x<span class="op">=</span><span class="va">gs</span>, <span class="va">Wetlab_Concentration</span>, subset <span class="op">=</span> <span class="st">"CD45+"</span>,</span>
<span>               nameKeyword<span class="op">=</span><span class="va">nameKeyword</span>, DilutionMultiplier<span class="op">=</span><span class="fl">100</span>,</span>
<span>               TotalVolume<span class="op">=</span><span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">TheData</span></span>
<span></span>
<span><span class="co">#ComputerSpecific &lt;- "C:/Users/JohnDoe/"</span></span>
<span><span class="co">#path &lt;- file.path(ComputerSpecific, "Desktop", "CellCounts")</span></span>
<span><span class="co">#CSVName &lt;- file.path(path, "CellCounts.csv")</span></span>
<span><span class="co">#write.csv(TheData, CSVName, row.names=FALSE)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="wetlab_rest">Wetlab_Rest<a class="anchor" aria-label="anchor" href="#wetlab_rest"></a>
</h3>
<p>Now that we know the concentration for each of our specimens, I take
this information and figure out what I need to do to re-suspend the
stock concentration to one of 3.0x10^6 cells per mL.</p>
<p>In actual practice, I will save the above data output as a .csv and
bring it back into R with the code as seen below:</p>
<p>Next up we bring in the CellCounts, and use Dillon’s Hammill’s
DataEditR to swap in the correct total volumes.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#ComputerSpecific &lt;- "C:/Users/JohnDoe/"</span></span>
<span><span class="co">#path &lt;- file.path(ComputerSpecific, "Desktop", "CellCounts")</span></span>
<span><span class="co">#CSVFiles &lt;- list.files(path, pattern=".csv")</span></span>
<span><span class="co">#FileInterest &lt;- file.path(path, CSVFiles[1])</span></span>
<span><span class="co">#TheData &lt;- read.csv(FileInterest, check.names=FALSE)</span></span>
<span><span class="va">TheData</span></span></code></pre></div>
<p>In the case of our workflow, sometimes when acquiring multiple
specimens, the TotalVolume the initial resuspension was in will differ
will differ between specimens. One could edit it within the outputted
.csv file before bringing into R, but another way is to use
<code>DataEditR</code> and edit it within R using it’s ShinyApp. The
Example code is provided below with a # symbol to avoid causing issues
with building the vignette. Don’t forget to synchronize to ensure the
edits to TotalVolume are retained.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">EditableData</span> <span class="op">&lt;-</span> <span class="va">TheData</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">TotalScientific</span>, <span class="op">-</span><span class="va">TimeSeconds</span><span class="op">)</span></span>
<span><span class="co">#NewData &lt;- DataEditR::data_edit(EditableData) #Remove the first # to run</span></span>
<span><span class="va">NewData</span> <span class="op">&lt;-</span> <span class="va">EditableData</span> <span class="co">#Add a # here if running DataEditR.</span></span>
<span><span class="va">Updated</span> <span class="op">&lt;-</span> <span class="va">NewData</span></span>
<span><span class="va">Updated</span></span></code></pre></div>
<p>With the TotalVolume column now correct, we can proceed to calculate
the re-suspension:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#ComputerSpecific &lt;- "C:/Users/JohnDoe/"</span></span>
<span><span class="co">#path &lt;- file.path(ComputerSpecific, "Desktop", "CellCounts")</span></span>
<span></span>
<span><span class="va">Test</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Wetlab_Rest.html">Wetlab_Rest</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">Updated</span>, DesiredConcentration_MillionperML<span class="op">=</span><span class="fl">3</span>, MaxMLperTube<span class="op">=</span><span class="fl">1</span>, returntype<span class="op">=</span><span class="st">"data"</span>, outpath<span class="op">=</span><span class="va">path</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://gt.rstudio.com/reference/gt.html" class="external-link">gt</a></span><span class="op">(</span><span class="va">Test</span><span class="op">)</span></span></code></pre></div>
<p>When the concentration is too low, SpinDown will be set to TRUE, and
an additional row consisting of the volume needed to resuspend in after
removing the supernatant will be placed immediately below.</p>
</div>
<div class="section level3">
<h3 id="wetlab_decision">Wetlab_Decision<a class="anchor" aria-label="anchor" href="#wetlab_decision"></a>
</h3>
<p>We also need to set a desired color-palette.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Palette &lt;- ghibli_palette(name="PonyoLight", n=7, direction=1, type="discrete")</span></span>
<span><span class="co">#ColorSelection &lt;- Palette[5]</span></span>
<span><span class="co">#scales::show_col(ColorSelection)</span></span>
<span></span>
<span><span class="va">Palette</span> <span class="op">&lt;-</span> <span class="fu">RColorBrewer</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html" class="external-link">brewer.pal</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">7</span>, name <span class="op">=</span> <span class="st">"Pastel1"</span><span class="op">)</span></span>
<span><span class="va">ColorSelection</span> <span class="op">&lt;-</span> <span class="va">Palette</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/show_col.html" class="external-link">show_col</a></span><span class="op">(</span><span class="va">ColorSelection</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>Hope this vignette was useful as a proof-of-principle.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by David Rach.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
