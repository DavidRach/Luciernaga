<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Unmixing with Luciernaga • Luciernaga</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Unmixing with Luciernaga">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">Luciernaga</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.99.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/DataVisualization.html">Data Visualization</a></li>
    <li><a class="dropdown-item" href="../articles/DimensionalityVisualization.html">Dimensionality Visualization</a></li>
    <li><a class="dropdown-item" href="../articles/QualityControl.html">Quality Control</a></li>
    <li><a class="dropdown-item" href="../articles/FluorescenceSignatures.html">Fluorescence Signatures</a></li>
    <li><a class="dropdown-item" href="../articles/FluorescentReports.html">Fluorescent Reports</a></li>
    <li><a class="dropdown-item" href="../articles/Unmixing.html">Unmixing with Luciernaga</a></li>
    <li><a class="dropdown-item" href="../articles/Wetlab.html">Wetlab Helper Functions</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/DavidRach/Luciernaga/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Unmixing with Luciernaga</h1>
                        <h4 data-toc-skip class="author">David Rach</h4>
            <address class="author_afil">
      University of Maryland,
Baltimore<br><a class="author_email" href="mailto:#"></a><a href="mailto:drach@som.umaryland.edu" class="email">drach@som.umaryland.edu</a>
      </address>
                  
            <h4 data-toc-skip class="date">1 June 2025</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/DavidRach/Luciernaga/blob/HEAD/vignettes/Unmixing.rmd" class="external-link"><code>vignettes/Unmixing.rmd</code></a></small>
      <div class="d-none name"><code>Unmixing.rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Unmixing is a black box for many spectral flow cytometry users, you
adjust gates on your single color controls, you provide full-stained
samples, you unmix and then you evaluate the outputs with NxN plots. The
golden rules of reference controls (1. Single Color Controls as Bright
or Brighter than Full-Stain Sample; 2. Unmixing Single Color should be
the same fluorophore (even better same manufacturer and lot); 3. Single
Color Controls should have autofluorescence subtracted from a
matching/equivalent unstained sample; 4. enough events) are useful
guidepost that obviously work but few have mechanistic explanations
behind why.</p>
<p>Building on examples from Jakob Theorell’s <em><a href="https://bioconductor.org/packages/3.19/flowSpecs" class="external-link">flowSpecs</a></em>
and Christopher Hall’s <a href="https://github.com/hally166/flowUnmix" class="external-link">flowUnmix</a> package, we
implemented a way to take <code><a href="../reference/Luciernaga_QC.html">Luciernaga_QC()</a></code> outputs of
purified fluorophore signatures and unmix them using ordinal least
squares (OLS) working from GatingSet objects, and returning FCS 3.0
standard files. In combination with functional programming principles,
we have been leveraging this to understand how variations of fluorophore
signature and brightness impact the unmixing of full-stained samples. We
hope our addditive contribution enables users to push the limits of SFC
and uncover new insights, write ways to handle issues arising from
relative heterogeneity of individual immune cells unmixed with
combination outputs, and spare future graduate students having to go
write their own R package to answer space-wormhole questions.</p>
</div>
<div class="section level2">
<h2 id="getting-started">Getting Started<a class="anchor" aria-label="anchor" href="#getting-started"></a>
</h2>
<p>This section uses the generated purified flourophore signatures
generated by <code><a href="../reference/Luciernaga_QC.html">Luciernaga_QC()</a></code> in the previous vignettes.</p>
<p>Let’s first load the required packages by calling them with
library.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://davidrach.github.io/Luciernaga/">Luciernaga</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">flowCore</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">flowWorkspace</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">openCyto</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RGLab/ggcyto/issues" class="external-link">ggcyto</a></span><span class="op">)</span>  </span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/" class="external-link">purrr</a></span><span class="op">)</span> </span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://stringr.tidyverse.org" class="external-link">stringr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://gt.rstudio.com" class="external-link">gt</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://plotly-r.com" class="external-link">plotly</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/rstudio/htmltools" class="external-link">htmltools</a></span><span class="op">)</span></span></code></pre></div>
<p>Then we can find the .fcs files stored within the
<code>Luciernaga</code> packages extdata folder and sort them by their
respective type</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">File_Location</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, package <span class="op">=</span> <span class="st">"Luciernaga"</span><span class="op">)</span></span>
<span><span class="va">FCS_Pattern</span> <span class="op">&lt;-</span> <span class="st">".fcs$"</span></span>
<span><span class="va">FCS_Files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">File_Location</span>, pattern <span class="op">=</span> <span class="va">FCS_Pattern</span>,</span>
<span>                        full.names <span class="op">=</span> <span class="cn">TRUE</span>, recursive <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">FCS_Files</span><span class="op">[</span><span class="fl">10</span><span class="op">:</span><span class="fl">30</span><span class="op">]</span>, <span class="fl">20</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">UnstainedFCSFiles</span> <span class="op">&lt;-</span> <span class="va">FCS_Files</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"Unstained"</span>, <span class="va">FCS_Files</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">UnstainedBeads</span> <span class="op">&lt;-</span> <span class="va">UnstainedFCSFiles</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"Beads"</span>, <span class="va">UnstainedFCSFiles</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">UnstainedCells</span> <span class="op">&lt;-</span> <span class="va">UnstainedFCSFiles</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"Beads"</span>, <span class="va">UnstainedFCSFiles</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="va">BeadFCSFiles</span> <span class="op">&lt;-</span> <span class="va">FCS_Files</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"Beads"</span>, <span class="va">FCS_Files</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">BeadSingleColors</span> <span class="op">&lt;-</span> <span class="va">BeadFCSFiles</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"Unstained"</span>, <span class="va">BeadFCSFiles</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="va">CellSingleColorFiles</span> <span class="op">&lt;-</span> <span class="va">FCS_Files</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"Cells"</span>, <span class="va">FCS_Files</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">CellSingleColors</span> <span class="op">&lt;-</span> <span class="va">CellSingleColorFiles</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="st">"Unstained"</span>, <span class="va">CellSingleColorFiles</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<p>Now lets create a GatingSet for our single-color cell unmixing
controls</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">MyCytoSet</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/flowWorkspace/man/load_cytoset_from_fcs.html" class="external-link">load_cytoset_from_fcs</a></span><span class="op">(</span><span class="va">CellSingleColors</span>, </span>
<span>                                   truncate_max_range <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>                                   transform <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">MyCytoSet</span></span>
<span><span class="va">MyGatingSet</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/flowWorkspace/man/GatingSet-class.html" class="external-link">GatingSet</a></span><span class="op">(</span><span class="va">MyCytoSet</span><span class="op">)</span></span>
<span><span class="va">MyGatingSet</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">FileLocation</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, package <span class="op">=</span> <span class="st">"Luciernaga"</span><span class="op">)</span></span>
<span><span class="va">MyGates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/fread.html" class="external-link">fread</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">FileLocation</span>, pattern <span class="op">=</span> <span class="st">'Gates.csv'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://gt.rstudio.com/reference/gt.html" class="external-link">gt</a></span><span class="op">(</span><span class="va">MyGates</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">MyGatingTemplate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/openCyto/man/gatingTemplate-class.html" class="external-link">gatingTemplate</a></span><span class="op">(</span><span class="va">MyGates</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/openCyto/man/gt_gating.html" class="external-link">gt_gating</a></span><span class="op">(</span><span class="va">MyGatingTemplate</span>, <span class="va">MyGatingSet</span><span class="op">)</span></span>
<span><span class="va">MyGatingSet</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<p>Now lets create a GatingSet for our unstained cell unmixing
controls</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">MyUnstainedCytoSet</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/flowWorkspace/man/load_cytoset_from_fcs.html" class="external-link">load_cytoset_from_fcs</a></span><span class="op">(</span><span class="va">UnstainedCells</span>, </span>
<span>                                   truncate_max_range <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>                                   transform <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">MyUnstainedCytoSet</span></span>
<span><span class="va">MyUnstainedGatingSet</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/flowWorkspace/man/GatingSet-class.html" class="external-link">GatingSet</a></span><span class="op">(</span><span class="va">MyUnstainedCytoSet</span><span class="op">)</span></span>
<span><span class="va">MyUnstainedGatingSet</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">FileLocation</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, package <span class="op">=</span> <span class="st">"Luciernaga"</span><span class="op">)</span></span>
<span><span class="va">MyGates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/fread.html" class="external-link">fread</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">FileLocation</span>, pattern <span class="op">=</span> <span class="st">'Gates.csv'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://gt.rstudio.com/reference/gt.html" class="external-link">gt</a></span><span class="op">(</span><span class="va">MyGates</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">MyGatingTemplate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/openCyto/man/gatingTemplate-class.html" class="external-link">gatingTemplate</a></span><span class="op">(</span><span class="va">MyGates</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/openCyto/man/gt_gating.html" class="external-link">gt_gating</a></span><span class="op">(</span><span class="va">MyGatingTemplate</span>, <span class="va">MyUnstainedGatingSet</span><span class="op">)</span></span>
<span><span class="va">MyUnstainedGatingSet</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="generate-luciernaga_qc-outputs">Generate Luciernaga_QC Outputs<a class="anchor" aria-label="anchor" href="#generate-luciernaga_qc-outputs"></a>
</h2>
<p>Now that the GatingSets are re-established, let’s continue where the
last vignette left off by processing all the fcs files with
<code>Luciernaga_QC</code> to characterize the fluorescent signatures
within.</p>
<p>Let’s first provision the AFOverlap csv to handle conflicts.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">FileLocation</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, package <span class="op">=</span> <span class="st">"Luciernaga"</span><span class="op">)</span></span>
<span><span class="va">pattern</span> <span class="op">=</span> <span class="st">"AutofluorescentOverlaps.csv"</span></span>
<span><span class="va">AFOverlap</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span>path<span class="op">=</span><span class="va">FileLocation</span>, pattern<span class="op">=</span><span class="va">pattern</span>,</span>
<span>                        full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">AFOverlap_CSV</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="va">AFOverlap</span>, check.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">AFOverlap_CSV</span></span></code></pre></div>
<p>And next generate a CellAF unstained signature that can be used when
these fluorophore-autofluorescence overlap files are encountered:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># pData(MyUnstainedGatingSet[1])</span></span>
<span><span class="va">removestrings</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">".fcs"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">TheCellAF</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span>.x<span class="op">=</span><span class="va">MyUnstainedGatingSet</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, .f<span class="op">=</span><span class="va">Luciernaga_QC</span>, subsets<span class="op">=</span><span class="st">"lymphocytes"</span>,</span>
<span>                              removestrings<span class="op">=</span><span class="va">removestrings</span>, sample.name<span class="op">=</span><span class="st">"GUID"</span>,</span>
<span>                              unmixingcontroltype <span class="op">=</span> <span class="st">"cells"</span>, Unstained <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                              ratiopopcutoff <span class="op">=</span> <span class="fl">0.001</span>, Verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                              AFOverlap <span class="op">=</span> <span class="va">AFOverlap</span>, stats <span class="op">=</span> <span class="st">"median"</span>,</span>
<span>                              ExportType <span class="op">=</span> <span class="st">"data"</span>, SignatureReturnNow <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                              outpath <span class="op">=</span> <span class="va">TemporaryFolder</span>, Increments<span class="op">=</span><span class="fl">0.1</span>,</span>
<span>                              SecondaryPeaks<span class="op">=</span><span class="fl">2</span>, experiment <span class="op">=</span> <span class="st">"FirstExperiment"</span>,</span>
<span>                              condition <span class="op">=</span> <span class="st">"ILTPanel"</span>, SCData<span class="op">=</span><span class="st">"subtracted"</span>,</span>
<span>                              NegativeType<span class="op">=</span><span class="st">"default"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">TheCellAF</span> <span class="op">&lt;-</span> <span class="va">TheCellAF</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="co">#Removes list caused by map</span></span>
<span></span>
<span><span class="fu"><a href="https://gt.rstudio.com/reference/gt.html" class="external-link">gt</a></span><span class="op">(</span><span class="va">TheCellAF</span><span class="op">)</span></span></code></pre></div>
<p>Now let’s use <code><a href="../reference/Luciernaga_QC.html">Luciernaga_QC()</a></code> with ExportType = “fcs” to
export the data as individual .fcs files, and set Brightness = TRUE to
save .csv files that can be used for <code><a href="../reference/Luciernaga_Tree.html">Luciernaga_Tree()</a></code>. For
this vignette, we will be saving the .fcs files to a temporary folder.
On your own workstation, save the outputs to a folder where you can
retrieve them later by providing a file.path to the outpath
argument.</p>
<p>Let’s start by processing the single-color unmixing controls.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#pData(MyGatingSet)</span></span>
<span></span>
<span><span class="va">StorageLocation</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"LuciernagaOutputs"</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.exists</a></span><span class="op">(</span><span class="va">StorageLocation</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">StorageLocation</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">SingleColor_Data</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span>.x<span class="op">=</span><span class="va">MyGatingSet</span>, .f<span class="op">=</span><span class="va">Luciernaga_QC</span>, subsets<span class="op">=</span><span class="st">"nonDebris"</span>,</span>
<span>                              removestrings<span class="op">=</span><span class="va">removestrings</span>, sample.name<span class="op">=</span><span class="st">"GUID"</span>,</span>
<span>                              unmixingcontroltype <span class="op">=</span> <span class="st">"cells"</span>, Unstained <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                              ratiopopcutoff <span class="op">=</span> <span class="fl">0.001</span>, Verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                              AFOverlap <span class="op">=</span> <span class="va">AFOverlap</span>, stats <span class="op">=</span> <span class="st">"median"</span>,</span>
<span>                              ExportType <span class="op">=</span> <span class="st">"fcs"</span>, Brightness<span class="op">=</span><span class="cn">TRUE</span>, SignatureReturnNow <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                              outpath <span class="op">=</span> <span class="va">StorageLocation</span>, Increments<span class="op">=</span><span class="fl">0.1</span>,</span>
<span>                              SecondaryPeaks<span class="op">=</span><span class="fl">2</span>, experiment <span class="op">=</span> <span class="st">"FirstExperiment"</span>,</span>
<span>                              condition <span class="op">=</span> <span class="st">"ILTPanel"</span>, Subtraction <span class="op">=</span> <span class="st">"Internal"</span>, </span>
<span>                              CellAF<span class="op">=</span><span class="va">TheCellAF</span>, SCData<span class="op">=</span><span class="st">"subtracted"</span>,</span>
<span>                              NegativeType<span class="op">=</span><span class="st">"default"</span>, minimalfcscutoff<span class="op">=</span><span class="fl">0.01</span><span class="op">)</span></span>
<span></span>
<span><span class="va">TheLuciernagaOutputs_FCS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">StorageLocation</span>, pattern<span class="op">=</span><span class="st">"fcs"</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">TheLuciernagaOutputs_FCS</span>, <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<p>And let’s also process an unstained unmixing control specimen also to
characterize autofluorescence that is present.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#pData(MyUnstainedGatingSet)</span></span>
<span><span class="va">Unstained_Data</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span>.x<span class="op">=</span><span class="va">MyUnstainedGatingSet</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, .f<span class="op">=</span><span class="va">Luciernaga_QC</span>, subsets<span class="op">=</span><span class="st">"nonDebris"</span>,</span>
<span>                              removestrings<span class="op">=</span><span class="va">removestrings</span>, sample.name<span class="op">=</span><span class="st">"GUID"</span>,</span>
<span>                              unmixingcontroltype <span class="op">=</span> <span class="st">"cells"</span>, Unstained <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                              ratiopopcutoff <span class="op">=</span> <span class="fl">0.001</span>, Verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                              AFOverlap <span class="op">=</span> <span class="va">AFOverlap</span>, stats <span class="op">=</span> <span class="st">"median"</span>,</span>
<span>                              ExportType <span class="op">=</span> <span class="st">"fcs"</span>, Brightness<span class="op">=</span><span class="cn">TRUE</span>, SignatureReturnNow <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                              outpath <span class="op">=</span> <span class="va">StorageLocation</span>, Increments<span class="op">=</span><span class="fl">0.1</span>,</span>
<span>                              SecondaryPeaks<span class="op">=</span><span class="fl">2</span>, experiment <span class="op">=</span> <span class="st">"FirstExperiment"</span>,</span>
<span>                              condition <span class="op">=</span> <span class="st">"ILTPanel"</span>, Subtraction <span class="op">=</span> <span class="st">"Internal"</span>, </span>
<span>                              CellAF<span class="op">=</span><span class="va">TheCellAF</span>, SCData<span class="op">=</span><span class="st">"subtracted"</span>,</span>
<span>                              NegativeType<span class="op">=</span><span class="st">"default"</span>, minimalfcscutoff<span class="op">=</span><span class="fl">0.01</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="luciernaga_tree">Luciernaga_Tree<a class="anchor" aria-label="anchor" href="#luciernaga_tree"></a>
</h2>
<p>We generate a lot of clusters with <code><a href="../reference/Luciernaga_QC.html">Luciernaga_QC()</a></code>. We
can visualize them using the report and plotting functions described in
the previous vignette, but selecting individual candidate output .fcs
for use in unmixing can be tiresome and confusing.
<code><a href="../reference/Luciernaga_Tree.html">Luciernaga_Tree()</a></code> is our initial attempt to reduce the
burden, by instituting a decision tree to help filter the many outputs
and return likely candidates that will work for unmixing. It relies on
the <code><a href="../reference/Luciernaga_QC.html">Luciernaga_QC()</a></code> Brightness=TRUE .csv outputs in making
this decision.</p>
<p>We want to be upfront and say this is developmental. We have recently
created the tools to allow us to query how fluorophore brightness,
signature, and relative abundance impact the unmixing of full-stained
samples. We have not had the time to delve into the outcomes at the
depth we would like to come up with a grand unified theory of perfect
unmixing. That is on my to-do-list as a postdoc/industry/whatever (hire
me if this interest you or you want to avoid me working for your
competitors). For the time, it works well enough, but with occasional
bugs in the final unmixing. We highly encourage your feedback and
tinkering with the decision trees step methodology in order to achieve
more consistent results. For now, the process works as follows (detailed
explanation logic).</p>
<p>With that background out of the way, let’s continue.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ReferencePath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, package <span class="op">=</span> <span class="st">"Luciernaga"</span><span class="op">)</span></span>
<span><span class="va">PanelPath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">ReferencePath</span>, <span class="st">"UnmixingPanel.csv"</span><span class="op">)</span></span>
<span><span class="va">UnmixingPanel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="va">PanelPath</span>, check.names<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">MoveThese</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Luciernaga_Tree.html">Luciernaga_Tree</a></span><span class="op">(</span>BrightnessFilePath <span class="op">=</span> <span class="va">StorageLocation</span>, PanelPath <span class="op">=</span> <span class="va">PanelPath</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://gt.rstudio.com/reference/gt.html" class="external-link">gt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">MoveThese</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>By scrolling through the returned selections, we can screen based on
our knowledge of the panel and decide if the outcomes seem reasonable.
We will also verify that these decisions were correct before we reach
the unmixing process by visualizing vs. reference signatures in
<code><a href="../reference/Luciernaga_SingleColors.html">Luciernaga_SingleColors()</a></code>. In the case that the wrong file
output was selected, it is much easier to remove and replace one .fcs
file than 30.</p>
</div>
<div class="section level2">
<h2 id="luciernaga_move">Luciernaga_Move<a class="anchor" aria-label="anchor" href="#luciernaga_move"></a>
</h2>
<p>Once <code><a href="../reference/Luciernaga_Tree.html">Luciernaga_Tree()</a></code> has identified the
<code><a href="../reference/Luciernaga_QC.html">Luciernaga_QC()</a></code> output .fcs files that will likely produce
the best unmixing outcome, it would be absolutely brutal having to track
down within a folder of hundreds of .fcs files with some repetition of
CCR4BUV615_UV6_10-V7_08-B3_04 nomenclature (believe me, I did so
initially). <code><a href="../reference/Luciernaga_Move.html">Luciernaga_Move()</a></code> takes the
<code><a href="../reference/Luciernaga_Tree.html">Luciernaga_Tree()</a></code> list of ideal candidates, and copies
these .fcs files to a designated folder, saving you the hassle, and
allowing you to simply point at that folder for use in the functions
mentioned below.</p>
<p>Continuing from where we left off with <code><a href="../reference/Luciernaga_Tree.html">Luciernaga_Tree()</a></code>
above, for this example, we will create a different temporary folder
were we will store the selected .fcs files for later use in the
unmixing.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">SortedStorageLocation</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"LuciernagaSelected"</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.exists</a></span><span class="op">(</span><span class="va">SortedStorageLocation</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">SortedStorageLocation</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">UnmixingPanel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="va">PanelPath</span>, check.names<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">TheseFluorophores</span> <span class="op">&lt;-</span> <span class="va">UnmixingPanel</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">Fluorophore</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">walk</a></span><span class="op">(</span>.x<span class="op">=</span><span class="va">TheseFluorophores</span>, .f<span class="op">=</span><span class="va">Luciernaga_Move</span>, data<span class="op">=</span><span class="va">MoveThese</span>, input<span class="op">=</span><span class="va">StorageLocation</span>, output<span class="op">=</span><span class="va">SortedStorageLocation</span><span class="op">)</span></span>
<span></span>
<span><span class="va">MovedFiles</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">SortedStorageLocation</span>, pattern<span class="op">=</span><span class="st">"fcs"</span>, full.names<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">MovedFiles</span><span class="op">)</span></span></code></pre></div>
<p>With these steps completed, we are now ready to proceed to the steps
to validate our choice in unmixing controls.</p>
</div>
<div class="section level2">
<h2 id="luciernaga_linearslices">Luciernaga_LinearSlices<a class="anchor" aria-label="anchor" href="#luciernaga_linearslices"></a>
</h2>
<p>We had previously showcased <code><a href="../reference/Luciernaga_LinearSlices.html">Luciernaga_LinearSlices()</a></code>
ability to take an .fcs file, and visualize variation in the signature
based on the quantile splits for the MFI brightness. What we saw for APC
CD16 is replicated below:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#pData(MyGatingSet)</span></span>
<span><span class="va">APC_Example</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">MyGatingSet</span>, <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">name</span>, <span class="st">"CD16_"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">RawSlices</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Luciernaga_LinearSlices.html">Luciernaga_LinearSlices</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">APC_Example</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, subset<span class="op">=</span><span class="st">"lymphocytes"</span>,</span>
<span>                                  sample.name<span class="op">=</span><span class="st">"GUID"</span>, removestrings<span class="op">=</span><span class="va">removestrings</span>,</span>
<span>                                  stats<span class="op">=</span><span class="st">"median"</span>, returntype<span class="op">=</span><span class="st">"raw"</span>,</span>
<span>                                  probsratio<span class="op">=</span><span class="fl">0.1</span>, output<span class="op">=</span><span class="st">"plot"</span>, desiredAF<span class="op">=</span><span class="st">"R1-A"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">plotly</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plotly/man/ggplotly.html" class="external-link">ggplotly</a></span><span class="op">(</span><span class="va">RawSlices</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#pData(MyGatingSet[6])</span></span>
<span></span>
<span><span class="va">NormalizedSlices</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Luciernaga_LinearSlices.html">Luciernaga_LinearSlices</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">APC_Example</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, subset<span class="op">=</span><span class="st">"lymphocytes"</span>,</span>
<span>                                  sample.name<span class="op">=</span><span class="st">"GUID"</span>, removestrings<span class="op">=</span><span class="va">removestrings</span>,</span>
<span>                                  stats<span class="op">=</span><span class="st">"median"</span>, returntype<span class="op">=</span><span class="st">"normalized"</span>,</span>
<span>                                  probsratio<span class="op">=</span><span class="fl">0.1</span>, output<span class="op">=</span><span class="st">"plot"</span>, desiredAF<span class="op">=</span><span class="st">"R1-A"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">plotly</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plotly/man/ggplotly.html" class="external-link">ggplotly</a></span><span class="op">(</span><span class="va">NormalizedSlices</span><span class="op">)</span></span></code></pre></div>
<p>For today, we highlight <code><a href="../reference/Luciernaga_LinearSlices.html">Luciernaga_LinearSlices()</a></code>
ability to do this also with the <code><a href="../reference/Luciernaga_QC.html">Luciernaga_QC()</a></code>
outputs.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">MovedFiles</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">SortedStorageLocation</span>, pattern<span class="op">=</span><span class="st">"fcs"</span>, full.names<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">Selected_CS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/flowWorkspace/man/load_cytoset_from_fcs.html" class="external-link">load_cytoset_from_fcs</a></span><span class="op">(</span><span class="va">MovedFiles</span>, truncate_max_range <span class="op">=</span> <span class="cn">FALSE</span>, transform <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">Selected_GS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/flowWorkspace/man/GatingSet-class.html" class="external-link">GatingSet</a></span><span class="op">(</span><span class="va">Selected_CS</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/Biobase/man/phenoData.html" class="external-link">pData</a></span><span class="op">(</span><span class="va">Selected_GS</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ThePlots</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span>.x<span class="op">=</span><span class="va">Selected_GS</span>, .f<span class="op">=</span><span class="va">Luciernaga_LinearSlices</span>, subset<span class="op">=</span><span class="st">"root"</span>, removestrings<span class="op">=</span><span class="st">".fcs"</span>,</span>
<span>                sample.name<span class="op">=</span><span class="st">"GUID"</span>, stats<span class="op">=</span><span class="st">"median"</span>, returntype<span class="op">=</span><span class="st">"normalized"</span>, output<span class="op">=</span><span class="st">"plot"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">plotly</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plotly/man/ggplotly.html" class="external-link">ggplotly</a></span><span class="op">(</span><span class="va">ThePlots</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p>As we can see, with the exception of cells below 30 percentile in
brightness, most of the variation in signature we saw in the original
file, and that the sorting within <code><a href="../reference/Luciernaga_QC.html">Luciernaga_QC()</a></code> appears
to have sorted cells of similar signature regardless of brightness.</p>
<p>By passing the generated plots to <code><a href="../reference/Utility_Patchwork.html">Utility_Patchwork()</a></code>,
we can set returntype=“pdf” or “patchwork” to generate a report for all
fluorophores.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">PatchworkObjects</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Utility_Patchwork.html">Utility_Patchwork</a></span><span class="op">(</span><span class="va">ThePlots</span>, filename <span class="op">=</span> <span class="st">"LinearSlices"</span>, outfolder<span class="op">=</span><span class="va">ReferencePath</span>, returntype <span class="op">=</span> <span class="st">"patchwork"</span><span class="op">)</span></span>
<span><span class="va">PatchworkObjects</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="luciernaga_singlecolors">Luciernaga_SingleColors<a class="anchor" aria-label="anchor" href="#luciernaga_singlecolors"></a>
</h2>
<p>The main purpose of <code><a href="../reference/Luciernaga_SingleColors.html">Luciernaga_SingleColors()</a></code> is to
generate a reference matrix for use in unmixing full-stained samples. It
additionally provides a mechanism by which we can visualize the
signatures we plan on using and compare them to the reference signatures
stored within <code>Luciernaga</code>. This allows us to screen out
potential issues in the single-color reference matrix before we proceed
to unmix the full-stained specimens.</p>
<p>To begin, we need to generate either a .csv file or a data.frame for
each of the fluorophores present, and specify a cutoff point for each,
dictated by our observations from what we saw with
<code><a href="../reference/Luciernaga_LinearSlices.html">Luciernaga_LinearSlices()</a></code>. For this example, we will do
this in R and set the intervals from 0.4 to 1.0 across the board. If you
want to fine-tune things further, it would be easier to save the output
as a .csv file, modify it, and then return it to R.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">UnmixingPanel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="va">PanelPath</span>, check.names<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">ThePanelCuts</span> <span class="op">&lt;-</span> <span class="va">UnmixingPanel</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">Detector</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>From<span class="op">=</span><span class="fl">0.3</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>To<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">ThePanelCuts</span>, <span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">#write.csv(ThePanelCuts, path="SaveHere.csv", row.names=FALSE)</span></span></code></pre></div>
<p>An important thing to ensure is that we correctly identify each
fluorophore and ligand at this step, to ensure names are correct in the
unmixed full-stained .fcs file. In this case, we are using the keyword
“TUBENAME” to identify between the .fcs files. This is what the original
name looks like:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/flowCore/man/keyword-methods.html" class="external-link">keyword</a></span><span class="op">(</span><span class="va">Selected_GS</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="st">"TUBENAME"</span><span class="op">)</span></span></code></pre></div>
<p><code><a href="../reference/Luciernaga_SingleColors.html">Luciernaga_SingleColors()</a></code> will automatically clean up
any portion of the name that has “(Cells)” or “(Beads)” present in it.
However, that would leave the final name as “DR_CCR4 BUV615” which would
be converted into Fluorophore = BUV615, Ligand = DR_CCR4. To clean this
up, we will remove the authors initials (“DR_”) by providing them as
part of a list to the remove strings argument.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#pData(Selected_GS)</span></span>
<span><span class="va">removestrings</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"DR_"</span>, <span class="st">".fcs"</span><span class="op">)</span></span>
<span><span class="va">SCs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span>.x<span class="op">=</span><span class="va">Selected_GS</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, .f<span class="op">=</span><span class="va">Luciernaga_SingleColors</span>, sample.name<span class="op">=</span><span class="st">"TUBENAME"</span>,</span>
<span>           removestrings<span class="op">=</span><span class="va">removestrings</span>, subset<span class="op">=</span><span class="st">"root"</span>, PanelCuts<span class="op">=</span><span class="va">ThePanelCuts</span>,</span>
<span>           stats<span class="op">=</span><span class="st">"median"</span>, Verbose<span class="op">=</span><span class="cn">TRUE</span>, SignatureView<span class="op">=</span><span class="cn">TRUE</span>, returntype <span class="op">=</span> <span class="st">"plots"</span><span class="op">)</span></span></code></pre></div>
<p>In the case above, we set the returntype = “plot” to visualize the
outcome compared to the stored Reference Signatures within
<code>Luciernaga</code>. Let’s see what these look like:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">plotly</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plotly/man/ggplotly.html" class="external-link">ggplotly</a></span><span class="op">(</span><span class="va">SCs</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p>As you can tell, the provided signature originating from our output
.fcs file closely resembles that of the reference signature. We can
repeat this for all the fluorophores and using
<code><a href="../reference/Utility_Patchwork.html">Utility_Patchwork()</a></code>, set returntype = “pdf” and examine all
fluorophores to spot any issues. For this example, I will set it the
argument to “patchwork” to visualize.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">SCs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span>.x<span class="op">=</span><span class="va">Selected_GS</span>, .f<span class="op">=</span><span class="va">Luciernaga_SingleColors</span>, sample.name<span class="op">=</span><span class="st">"TUBENAME"</span>,</span>
<span>           removestrings<span class="op">=</span><span class="va">removestrings</span>, subset<span class="op">=</span><span class="st">"root"</span>, PanelCuts<span class="op">=</span><span class="va">ThePanelCuts</span>,</span>
<span>           stats<span class="op">=</span><span class="st">"median"</span>, Verbose<span class="op">=</span><span class="cn">TRUE</span>, SignatureView<span class="op">=</span><span class="cn">TRUE</span>, returntype <span class="op">=</span> <span class="st">"plots"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">TheView</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Utility_Patchwork.html">Utility_Patchwork</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">SCs</span>, filename<span class="op">=</span><span class="st">"ReferenceMatches"</span>,</span>
<span>                             outfolder <span class="op">=</span> <span class="va">ReferencePath</span>, returntype <span class="op">=</span> <span class="st">"patchwork"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">TheView</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span></span></code></pre></div>
<p>In this particular case, we can see that while most generated
signatures aligned with their references, the .fcs files we are using
for BUV737 and PacificBlue deviate substantially and are likely to
impact the final unmixing. Within our workflow, we would follow up by
removing the current output .fcs from the Selected Folder, and replace
it with another variant.</p>
<p>While this highlights the visualizing portion of
<code><a href="../reference/Luciernaga_SingleColors.html">Luciernaga_SingleColors()</a></code> lets go ahead and generate the
reference matrix by changing returntype = “data”</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">SC_Reference</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span>.x<span class="op">=</span><span class="va">Selected_GS</span>, .f<span class="op">=</span><span class="va">Luciernaga_SingleColors</span>, sample.name<span class="op">=</span><span class="st">"TUBENAME"</span>,</span>
<span>                    removestrings<span class="op">=</span><span class="va">removestrings</span>, subset<span class="op">=</span><span class="st">"root"</span>, PanelCuts<span class="op">=</span><span class="va">ThePanelCuts</span>,</span>
<span>                    stats<span class="op">=</span><span class="st">"median"</span>, Verbose<span class="op">=</span><span class="cn">FALSE</span>, SignatureView<span class="op">=</span><span class="cn">FALSE</span>, returntype <span class="op">=</span> <span class="st">"data"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">SC_Reference</span>, <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<p>While we are at it, we might as well identify how far the cosine
difference for the trouble Pacific Blue Fluorophore is before we go and
correct it:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">PacificBlue</span> <span class="op">&lt;-</span> <span class="va">SC_Reference</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">Ligand</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>Sample<span class="op">=</span><span class="va">Fluorophore</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/QC_WhatsThis.html">QC_WhatsThis</a></span><span class="op">(</span>x<span class="op">=</span><span class="st">"Pacific Blue"</span>, data<span class="op">=</span><span class="va">PacificBlue</span>, NumberHits<span class="op">=</span><span class="fl">10</span>,</span>
<span>                        returnPlots <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Results</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">plotly</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plotly/man/ggplotly.html" class="external-link">ggplotly</a></span><span class="op">(</span><span class="va">Results</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p>As you can tell, the fluorophore more closely resembles BV510 with no
Pacific Blue appearing in the list of hits. This suggest that the
returned fluorescent signature in the .fcs file is mainly
autofluorescence, and should not be used.</p>
<p>Back on topic, once we have corrected the Selected Folder, rerun
<code><a href="../reference/Luciernaga_SingleColors.html">Luciernaga_SingleColors()</a></code> and are satisfied with out
results, we should go ahead and save the results data.frame elsewhere
for further reference, or that they can be so edited to correct for any
typos or format issues that may have been missed before creating unmixed
.fcs files.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">SC_Reference</span> <span class="op">&lt;-</span> <span class="va">SC_Reference</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Fluorophore <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span><span class="va">Fluorophore</span> <span class="op">==</span> <span class="st">"Unstained"</span> <span class="op">~</span> <span class="st">"AF"</span>, <span class="cn">TRUE</span> <span class="op">~</span> <span class="va">Fluorophore</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">TheSCReferences</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">ReferencePath</span>, <span class="st">"UnmixingSCs.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">SC_Reference</span>, <span class="va">TheSCReferences</span>, row.names<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="luciernaga_unmix">Luciernaga_Unmix<a class="anchor" aria-label="anchor" href="#luciernaga_unmix"></a>
</h2>
<p><code><a href="../reference/Luciernaga_Unmix.html">Luciernaga_Unmix()</a></code> is the unmixing function implemented
within the <code>Luciernaga</code> package. What mainly distinguishes it
from other R package implementations of ordinary least squares unmixing
is it works at the GatingSet level in terms of infrastructure (reducing
active memory use) and is set up in such a way to allow us to rapidly
iterate/modify/change the inputs to subsequently evaluate the unmixed
full-stained .fcs files for the impacts that those decisions had on the
unmixing. We have put some effort into ensuring that the subsequent
unmixed files are compatible with various software typically used by
those who prefer to use GUI for their flow data. This involved changes
done within the newly produced .fcs files exprs, parameters and
description folder, it’s possible we may have missed something, so if
you encounter a bug, please reach out.</p>
<p>As previously stated, this remains experimental, and at the moment is
just intended as a tool to allow me to querry how
brightness/signature/abundance of individual single colors impacts the
full-unmixing. As I improve on my existing knowledge, the quality of
inputs/outputs is likely to also improve as I figure out the things that
I don’t yet know and correct for them. So consider this a work in
progress for now, feel free to reach out if you know something I don’t,
and want to collaborate on getting it implemented here.</p>
<p>For now, let’s identify the raw full-stained files and load them into
a GatingSet:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">File_Location</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, package <span class="op">=</span> <span class="st">"Luciernaga"</span><span class="op">)</span></span>
<span><span class="va">FCS_Pattern</span> <span class="op">&lt;-</span> <span class="st">".fcs$"</span></span>
<span><span class="va">FCS_Files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">File_Location</span>, pattern <span class="op">=</span> <span class="va">FCS_Pattern</span>,</span>
<span>                        full.names <span class="op">=</span> <span class="cn">TRUE</span>, recursive <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">RawFullStainedFCSFiles</span> <span class="op">&lt;-</span> <span class="va">FCS_Files</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"Tetramer"</span>, <span class="va">FCS_Files</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">RawFullStainedFCSFiles</span> <span class="op">&lt;-</span> <span class="va">RawFullStainedFCSFiles</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"Unmixed"</span>, <span class="va">RawFullStainedFCSFiles</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="va">UnmixCytoSet</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/flowWorkspace/man/load_cytoset_from_fcs.html" class="external-link">load_cytoset_from_fcs</a></span><span class="op">(</span><span class="va">RawFullStainedFCSFiles</span>, truncate_max_range <span class="op">=</span> <span class="cn">FALSE</span>, transform <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">UnmixGatingSet</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/flowWorkspace/man/GatingSet-class.html" class="external-link">GatingSet</a></span><span class="op">(</span><span class="va">UnmixCytoSet</span><span class="op">)</span>                                                </span></code></pre></div>
<p>Let’s identify the Single Color Reference Data output from
<code><a href="../reference/Luciernaga_SingleColors.html">Luciernaga_SingleColors()</a></code> that we have validated
(correcting from any issues)</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ReferencePath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, package <span class="op">=</span> <span class="st">"Luciernaga"</span><span class="op">)</span></span>
<span><span class="va">ValidatedSCReferenceData</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">ReferencePath</span>, <span class="st">"ValidatedSCReferenceData.csv"</span><span class="op">)</span></span>
<span><span class="va">SingleColorReference</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="va">ValidatedSCReferenceData</span>, check.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>And finally, lets provide a file.path to the panel (to establish
correct ordering of fluorophores in the final file)</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">PanelPath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">ReferencePath</span>, <span class="st">"UnmixingPanel.csv"</span><span class="op">)</span></span>
<span><span class="va">PanelNames</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="va">PanelPath</span>, check.names<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>With these pre-requisites prepared we can go ahead. For this example,
we will merge the “GROUPNAME” and “TUBENAME” to form the final name. For
the final file, we will use the addon argument to append “_Unmixed” at
the end. As Ordinary Least Squares (OLS) returns values close to 0, the
multiplier increases all values across the board, which allows the data
to resemble that of other softwares when the bi-exponential transform is
applied.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">TheSampleName</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"GROUPNAME"</span>, <span class="st">"TUBENAME"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">UnmixSuccess</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span>.x<span class="op">=</span><span class="va">UnmixGatingSet</span>, .f<span class="op">=</span><span class="va">Luciernaga_Unmix</span>, controlData<span class="op">=</span><span class="va">SingleColorReference</span>,</span>
<span>                    sample.name<span class="op">=</span><span class="va">TheSampleName</span>, addon<span class="op">=</span><span class="st">"_Unmixed"</span>, subset<span class="op">=</span><span class="st">"root"</span>, removestrings<span class="op">=</span><span class="st">".fcs"</span>,</span>
<span>                    multiplier<span class="op">=</span><span class="fl">50000</span>, outpath<span class="op">=</span><span class="va">UnmixedOutpath</span>, PanelPath<span class="op">=</span><span class="va">PanelPath</span>, Verbose<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="luciernaga_iterativeunmix">Luciernaga_IterativeUnmix<a class="anchor" aria-label="anchor" href="#luciernaga_iterativeunmix"></a>
</h2>
<p>This function is an extension of <code><a href="../reference/Luciernaga_Unmix.html">Luciernaga_Unmix()</a></code>
using the same inputs, with the added provision that you provide it a
folder of variant of <code><a href="../reference/Luciernaga_QC.html">Luciernaga_QC()</a></code> .fcs files for a
single fluorophore of interest. <code>Luciernaga_IterativeUnmix()</code>
will then proceed one by one through the files in that folder, process
them individually and swap them in to the Reference Matrix, unmix the
full-stain samples, and return the variant unmixed full-stain files to
the outfolder. It will repeat this until everything is complete. What we
will do subsequently, is use <code>Utility_UnityPlots()</code> and
<code>Utility_NxNPlots()</code> and the workflow described in Vignette 1
to consolidate all the variant unmixed files and evaluate how the
variation in that iterated single-color impacted the final unmixing.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">IterativePath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">ReferencePath</span>, <span class="st">"DifferentialPerCP"</span><span class="op">)</span></span>
<span><span class="va">removestrings</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"DR_"</span>, <span class="st">".fcs"</span><span class="op">)</span></span>
<span><span class="va">iterate_removestrings</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"DR_"</span>, <span class="st">"(Cells)"</span>, <span class="st">".fcs"</span>, <span class="st">" "</span>, <span class="st">"PerCP-Cy5.5"</span>, <span class="st">"CD26"</span>, <span class="st">"_"</span><span class="op">)</span></span>
<span><span class="va">TheSampleName</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"GROUPNAME"</span>, <span class="st">"TUBENAME"</span><span class="op">)</span> </span>
<span></span>
<span></span>
<span><span class="fu"><a href="../reference/Luciernaga_IterativeUnmixing.html">Luciernaga_IterativeUnmixing</a></span><span class="op">(</span>IterativePath<span class="op">=</span><span class="va">IterativePath</span>, iterate_removestrings<span class="op">=</span><span class="va">iterate_removestrings</span>,</span>
<span>                               removestrings<span class="op">=</span><span class="va">removestrings</span>, sample.name<span class="op">=</span><span class="va">TheSampleName</span>, subset<span class="op">=</span><span class="st">"root"</span>,</span>
<span>                               PanelCuts<span class="op">=</span><span class="va">ThePanelCuts</span>, stats<span class="op">=</span><span class="st">"median"</span>, Verbose<span class="op">=</span><span class="cn">FALSE</span>, SignatureView<span class="op">=</span><span class="cn">FALSE</span>,</span>
<span>                               FullStainedGS<span class="op">=</span><span class="va">UnmixGatingSet</span>, controlData<span class="op">=</span><span class="va">SingleColorReference</span>, multiplier<span class="op">=</span><span class="fl">50000</span>,</span>
<span>                               outpath<span class="op">=</span><span class="va">UnmixedOutpath</span>, PanelPath<span class="op">=</span><span class="va">PanelPath</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>And with that, we conclude our tour of the current state of the
unmixing functions within the <code>Luciernaga</code> package. They
remain a work in progress, and we welcome any
contributions/insights/bug-reports to continue improving on them. This
entire project arose when curious of how placing a positive gate on a
single-color unmixing control would alter the unmixing of that file, and
the sum of <code>Luciernaga</code>’s functions have been geared to
allowing me to answer these questions so that no other graduate student
will have to go through the horror of “it unmixed weird, no idea why” 20
years from now.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by David Rach.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
